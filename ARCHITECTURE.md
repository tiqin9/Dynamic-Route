# ğŸ¯ System Overview & Architecture Diagram

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER INTERFACES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  http://localhost:5000/          http://localhost:5000/planner  â”‚
â”‚  (Basic Planner)                (Advanced Dynamic Planner) â­   â”‚
â”‚                                                                   â”‚
â”‚  â€¢ Create Routes                 â€¢ Orders Management            â”‚
â”‚  â€¢ Manual Stops                  â€¢ Advanced Constraints         â”‚
â”‚  â€¢ Simple Map                    â€¢ Multi-Route Planning         â”‚
â”‚  â€¢ Basic Metrics                 â€¢ Interactive Maps             â”‚
â”‚                                  â€¢ Real-time Analytics          â”‚
â”‚                                  â€¢ Export Manifests             â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• HTTP/JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXPRESS.JS SERVER                          â”‚
â”‚                  http://localhost:5000                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ REST API LAYER (13+ Endpoints)                          â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Orders      Routes      Plans      System              â”‚  â”‚
â”‚  â”‚  â”œâ”€ POST     â”œâ”€ POST     â”œâ”€ POST    â”œâ”€ GET /health     â”‚  â”‚
â”‚  â”‚  â”œâ”€ GET      â”œâ”€ GET      â””â”€ GET     â””â”€ GET /constraintsâ”‚  â”‚
â”‚  â”‚  â””â”€ DELETE   â”œâ”€ DELETE                                 â”‚  â”‚
â”‚  â”‚             â””â”€ OPTIMIZE                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†•                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OPTIMIZATION ENGINE LAYER                               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  milkRunOptimizer.ts (350 lines)                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ optimizeMilkRuns()         [Main algorithm]         â”‚  â”‚
â”‚  â”‚  â”œâ”€ canTruckFitOrder()         [Volume validation]      â”‚  â”‚
â”‚  â”‚  â”œâ”€ isVORDistanceValid()       [Geographic check]       â”‚  â”‚
â”‚  â”‚  â”œâ”€ canAddOrderToRoute()       [All constraints]        â”‚  â”‚
â”‚  â”‚  â”œâ”€ optimizeRouteSequence()    [Nearest neighbor]       â”‚  â”‚
â”‚  â”‚  â””â”€ calculateRouteMetrics()    [Stats calculation]      â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  routeOptimizer.ts (150 lines)                          â”‚  â”‚
â”‚  â”‚  â”œâ”€ haversineDistance()        [Distance calc]          â”‚  â”‚
â”‚  â”‚  â”œâ”€ optimizeRoute2Opt()        [Local search]           â”‚  â”‚
â”‚  â”‚  â””â”€ calculateTotalTime()       [Time estimation]        â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†•                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ DATA LAYER                                              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  In-Memory Storage                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Orders Map      { id â†’ Order }                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ Routes Map      { id â†’ Route }                      â”‚  â”‚
â”‚  â”‚  â””â”€ Plans Map       { id â†’ RoutePlan }                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Type System (types.ts)                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ Order           [4 types: HV, HVB, VOR, MRB]        â”‚  â”‚
â”‚  â”‚  â”œâ”€ Stop            [Delivery location]                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ Route           [Complete route]                    â”‚  â”‚
â”‚  â”‚  â”œâ”€ Truck           [Vehicle details]                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ RoutePlan       [Multi-route plan]                  â”‚  â”‚
â”‚  â”‚  â””â”€ ConstraintSet   [Planning parameters]               â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Mock Services (mockServices.ts)                         â”‚  â”‚
â”‚  â”‚  â”œâ”€ MockMFSAPI             [High-value orders]          â”‚  â”‚
â”‚  â”‚  â”œâ”€ MockServiceCenterAPI   [Battery returns]            â”‚  â”‚
â”‚  â”‚  â””â”€ Sample Data Generator  [26 orders]                  â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

```
User Input
    â”‚
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Orders                             â”‚
â”‚ â€¢ Sample data (26 orders)               â”‚
â”‚ â€¢ Custom order creation                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Orders Map Storage      â”‚
        â”‚ {id â†’ Order}            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Configure Constraints             â”‚
     â”‚ â€¢ Max stops: 3                     â”‚
     â”‚ â€¢ Volume limits                    â”‚
     â”‚ â€¢ Time windows                     â”‚
     â”‚ â€¢ Geographic rules                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ POST /api/plan                      â”‚
     â”‚ â€¢ Submit orders & constraints       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ optimizeMilkRuns()                  â”‚
     â”‚ 1. Sort orders by priority          â”‚
     â”‚ 2. Greedy assignment                â”‚
     â”‚ 3. Validate constraints             â”‚
     â”‚ 4. Optimize sequences               â”‚
     â”‚ 5. Calculate metrics                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Routes Map Storage      â”‚
        â”‚ {id â†’ Route}            â”‚
        â”‚ {id â†’ RoutePlan}        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ GET /api/routes (All routes)        â”‚
     â”‚ GET /api/plan/:id (Plan details)    â”‚
     â”‚ GET /api/routes/:id (Route details) â”‚
     â”‚ GET /api/routes/:id/manifest (Txt)  â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ Frontend Display                    â”‚
     â”‚ â€¢ Route summaries                   â”‚
     â”‚ â€¢ Distance/time metrics             â”‚
     â”‚ â€¢ Interactive map                   â”‚
     â”‚ â€¢ Download manifests                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Algorithm Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MILK RUN OPTIMIZATION ALGORITHM             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PHASE 1: SORT ORDERS   â”‚
        â”‚                        â”‚
        â”‚ Priority: DESC         â”‚
        â”‚ Type: HVB>HV>VOR>MRB   â”‚
        â”‚ Date: ASC              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PHASE 2: GREEDY ASSIGNMENT        â”‚
        â”‚                                   â”‚
        â”‚ For each order (sorted):          â”‚
        â”‚   For each route:                 â”‚
        â”‚     if fits? â†’ add & break        â”‚
        â”‚   if not assigned:                â”‚
        â”‚     create new route              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PHASE 3: CONSTRAINT VALIDATION â”‚
        â”‚                                 â”‚
        â”‚ Check:                          â”‚
        â”‚ âœ“ Volume capacity              â”‚
        â”‚ âœ“ Stop count limit             â”‚
        â”‚ âœ“ Route duration               â”‚
        â”‚ âœ“ VOR geographic rules         â”‚
        â”‚ âœ“ Truck type matching          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PHASE 4: SEQUENCE OPTIMIZATION   â”‚
        â”‚                                  â”‚
        â”‚ Nearest Neighbor:               â”‚
        â”‚ 1. Start at origin              â”‚
        â”‚ 2. Find nearest unvisited       â”‚
        â”‚ 3. Add to sequence              â”‚
        â”‚ 4. Repeat until all             â”‚
        â”‚ 5. Return to origin             â”‚
        â”‚                                  â”‚
        â”‚ Optional 2-Opt:                 â”‚
        â”‚ â€¢ Try reversing segments        â”‚
        â”‚ â€¢ Keep improvements             â”‚
        â”‚ â€¢ N iterations                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PHASE 5: METRICS CALCULATION â”‚
        â”‚                              â”‚
        â”‚ Per Route:                   â”‚
        â”‚ â€¢ Distance (Haversine)       â”‚
        â”‚ â€¢ Time (dist + delivery)     â”‚
        â”‚ â€¢ Volume utilization         â”‚
        â”‚ â€¢ Efficiency (km/pack)       â”‚
        â”‚                              â”‚
        â”‚ Plan Summary:                â”‚
        â”‚ â€¢ Total routes               â”‚
        â”‚ â€¢ Trucks needed              â”‚
        â”‚ â€¢ Total distance             â”‚
        â”‚ â€¢ Total time                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ RETURN RoutePlan â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Constraint Validation Tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Can Add Order to Route?                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Check 1         â”‚ Check 2         â”‚ Check 3
      â”‚ Volume Fit?     â”‚ Stop Limit?    â”‚ Type Match?
      â†“                 â†“                 â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚ NO   â”‚         â”‚ NO   â”‚         â”‚ NO   â”‚
   â”‚      â”‚         â”‚      â”‚         â”‚      â”‚
   â””â”€â”€â”€â”¬â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”˜         â””â”€â”€â”€â”¬â”€â”€â”˜
       â”‚                â”‚                â”‚
       â†“                â†“                â†“
  New Route         New Route        New Route
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Check 4               Check 5
      â”‚ Time OK?              VOR OK?
      â†“                       â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”
   â”‚ NO   â”‚             â”‚ NO   â”‚
   â”‚      â”‚             â”‚      â”‚
   â””â”€â”€â”€â”¬â”€â”€â”˜             â””â”€â”€â”€â”¬â”€â”€â”˜
       â”‚                    â”‚
       â†“                    â†“
  New Route/            New Route/
  Layover              Different
       â”‚               Time
       â”‚                   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ ALL PASS   â”‚
        â”‚ ADD ORDER  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Dependencies

```
server.ts
â”œâ”€ types.ts           [Data interfaces]
â”œâ”€ routeOptimizer.ts  [Basic optimization]
â”œâ”€ milkRunOptimizer.ts [Advanced optimization]
â”‚  â””â”€ types.ts
â”‚  â””â”€ routeOptimizer.ts
â””â”€ mockServices.ts    [Service integrations]
   â””â”€ types.ts

planner.html
â”œâ”€ Leaflet.js         [Mapping]
â””â”€ [Standalone JS]

index.html
â”œâ”€ Leaflet.js         [Mapping]
â””â”€ [Standalone JS]
```

---

## Technology Stack Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PRESENTATION LAYER                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  HTML5 + CSS3 + JavaScript (Vanilla)         â”‚
â”‚  â€¢ Tabs & Forms                              â”‚
â”‚  â€¢ Event Handling                            â”‚
â”‚  â€¢ DOM Manipulation                          â”‚
â”‚  â€¢ REST API Calls                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ HTTP/JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          APPLICATION LAYER                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Node.js + Express.js                        â”‚
â”‚  â€¢ Routing                                   â”‚
â”‚  â€¢ Request Handling                          â”‚
â”‚  â€¢ Response Formatting                       â”‚
â”‚  â€¢ Error Handling                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          BUSINESS LOGIC LAYER                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TypeScript (Compiled to JavaScript)         â”‚
â”‚  â€¢ Optimization Algorithms                   â”‚
â”‚  â€¢ Constraint Validation                     â”‚
â”‚  â€¢ Data Processing                           â”‚
â”‚  â€¢ Service Integration                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DATA LAYER                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  In-Memory Storage (JavaScript Maps)         â”‚
â”‚  â€¢ Orders                                    â”‚
â”‚  â€¢ Routes                                    â”‚
â”‚  â€¢ Plans                                     â”‚
â”‚                                              â”‚
â”‚  External APIs (Simulated)                   â”‚
â”‚  â€¢ MFS API                                   â”‚
â”‚  â€¢ Service Center API                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend (HTML)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ /planner.html (Advanced UI)
           â”œâ”€ /index.html (Basic UI)
           â””â”€ Static assets
                â”‚
                â†“ HTTP/JSON
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Express.js Router                â”‚
â”‚  localhost:5000                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  â”œâ”€ GET /                             â”‚
â”‚  â”œâ”€ POST /api/orders                 â”‚
â”‚  â”œâ”€ GET /api/orders                  â”‚
â”‚  â”œâ”€ POST /api/plan                   â”‚
â”‚  â”œâ”€ GET /api/routes                  â”‚
â”‚  â”œâ”€ POST /api/routes/:id/optimize    â”‚
â”‚  â””â”€ ... 7 more endpoints             â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â†’ milkRunOptimizer.ts
        â”‚   (Core Logic)
        â”‚
        â”œâ”€â†’ routeOptimizer.ts
        â”‚   (Basic Algorithms)
        â”‚
        â”œâ”€â†’ mockServices.ts
        â”‚   (Simulated APIs)
        â”‚
        â””â”€â†’ Types System
            (Data Validation)
```

---

## Order Flow Through System

```
User Action
    â”‚
    â”œâ”€ [Create Order] â†’ POST /api/orders
    â”‚
    â”œâ”€ [Load Samples] â†’ POST /api/sample-data
    â”‚
    â”œâ”€ [Plan Routes] â†’ POST /api/plan
    â”‚
    â””â”€ [View Results] â†’ GET /api/routes + Leaflet Map
    
    
    
Within /api/plan:
    â”‚
    â”œâ”€ Parse request
    â”‚
    â”œâ”€ Get orders from storage
    â”‚
    â”œâ”€ Call optimizeMilkRuns()
    â”‚   â”œâ”€ Sort orders
    â”‚   â”œâ”€ Greedy assign
    â”‚   â”œâ”€ Validate constraints
    â”‚   â”œâ”€ Optimize sequences
    â”‚   â””â”€ Calculate metrics
    â”‚
    â”œâ”€ Store in routes map
    â”‚
    â””â”€ Return plan JSON
```

---

## Deployment Architecture (Optional Future)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Load Balancer â”‚
â”‚   (Optional)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚        â”‚        â”‚
    â†“            â†“        â†“        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Express.js Instances (Node)        â”‚
â”‚  (Can run multiple for load balancing) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â†’ Database (future: PostgreSQL)
    â”‚   â””â”€ Persist orders, routes, plans
    â”‚
    â”œâ”€â†’ Cache (future: Redis)
    â”‚   â””â”€ Cache frequent queries
    â”‚
    â””â”€â†’ Real Services
        â”œâ”€ MFS API
        â””â”€ Service Center API
```

---

## Performance Characteristics

```
Request Processing Pipeline:

Order Input (0ms)
    â†“
Parse JSON (0-1ms)
    â†“
Validate Input (0-1ms)
    â†“
Run Optimization (100-500ms)
    â”œâ”€ Sort: 1-10ms
    â”œâ”€ Assign: 50-200ms
    â”œâ”€ Validate: 20-100ms
    â”œâ”€ Optimize: 20-100ms
    â””â”€ Metrics: 1-5ms
    â†“
Format Response (1-5ms)
    â†“
Send JSON (1-10ms)
    â†“
Frontend Render (100-500ms)
    â”œâ”€ Parse JSON: 1-5ms
    â”œâ”€ Update DOM: 10-50ms
    â”œâ”€ Render Map: 50-300ms
    â””â”€ Redraw UI: 20-100ms
    â†“
Complete (total: ~500-1000ms)
```

---

## Scale Capability

```
Current: 50 orders â†’ 8-12 routes
         ~1 second processing

10x Scale: 500 orders â†’ 80-120 routes
           ~5 seconds processing
           (with optimization)

100x Scale: 5000 orders â†’ 800-1200 routes
            ~30-50 seconds processing
            (batching required)

1000x Scale: 50000 orders â†’ Needs:
             â€¢ Database (not in-memory)
             â€¢ Distributed processing
             â€¢ Advanced caching
             â€¢ Service mesh
```

---

**Architecture Last Updated**: January 2026  
**System Status**: âœ… Fully Operational  
**Deployment**: Single-instance Node.js
